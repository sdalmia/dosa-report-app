<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dosa Coffee Report Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body>
  <div class="container py-5">
    <div class="text-center mb-4">
      <img
        src="{{ url_for('static', filename='logo.png') }}"
        alt="Dosa Coffee Logo"
        style="max-width: 200px; height: auto"
      />
    </div>

    <div class="card border-info mb-4 shadow-sm">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0">About this Tool</h5>
      </div>
      <div class="card-body">
        <p class="card-text">
          This tool allows you to upload multiple Zomato Settlement Report Excel
          files and generates a consolidated master payout report for Dosa Coffee.
        </p>
        <p><strong>Usage Guidelines:</strong></p>
        <ul>
          <li>
            Upload one or more <code>.xlsx</code> settlement files exported from
            Zomato.
          </li>
          <li>
            The reports must contain sheets named <code>Order Level</code>,
            <code>Addition Deductions Details</code>, and <code>Summary</code>.
          </li>
          <li>
            The tool extracts relevant payout and tax columns, sums data across
            files, and outputs a master Excel file.
          </li>
          <li>
            Processing may take some time depending on the number and size of files
            uploaded.
          </li>
        </ul>
      </div>
    </div>

    <h2 class="mb-4">üìä Dosa Coffee Report Uploader</h2>

    <form method="POST" enctype="multipart/form-data" onsubmit="showSpinner()">
      <div class="mb-3">
        <label for="files" class="form-label"
          >Upload Zomato Settlement Files (.xlsx):</label
        >
        <input
          type="file"
          class="form-control"
          id="files"
          name="files"
          multiple
          required
        />
      </div>
      <button type="submit" class="btn btn-primary" id="submit-btn">
        Generate Master File
      </button>
    </form>

    <!-- Loading spinner -->
    <div
      id="loadingSpinner"
      class="text-center mt-4"
      style="display: none"
      role="status"
      aria-live="polite"
      aria-busy="true"
    >
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Processing...</span>
      </div>
      <div class="mt-2">Processing your files, please wait...</div>
    </div>

    <!-- Logs -->
    {% if logs %}
    <div class="mt-4">
      <h5 class="mb-3">üìù Processing Log</h5>
      <ul class="list-group">
        {% for line in logs %}
        <li class="list-group-item">{{ line }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <!-- Download button -->
    {% if download_link %}
    <div class="mt-4">
      <a
        class="btn btn-success"
        href="{{ download_link }}"
        download
        >‚¨áÔ∏è Download Master Report</a
      >
    </div>
    {% endif %}
  </div>

  <footer class="mt-5 py-4 border-top bg-light text-center text-muted small">
    <div class="container">
      <p class="mb-1">&copy; {{ current_year }} Dalgreen Foods Private Limited. All rights
        reserved.</p>
      <p class="mb-0 fst-italic">
        This software is provided &ldquo;as is&rdquo; without warranty of any kind.
        Users must ensure compliance with applicable laws and regulations.
        Dalgreen Foods Private Limited is not responsible for any data loss or inaccuracies.
      </p>
    </div>
  </footer>

  <script>
    function showSpinner() {
      document.getElementById("submit-btn").disabled = true;
      document.getElementById("loadingSpinner").style.display = "block";
    }
  </script>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  ></script>
</body>
</html>
